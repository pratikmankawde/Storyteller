{  "project": "Dramebaz",  "category": "Insights & Analysis Enhancements",  "description": "Enhanced insights and analysis features from NovelReaderWeb - Emotional Arc Visualization and Foreshadowing Detection",  "version": "1.0",  "last_updated": "2026-02-03",  "instructions_source": "NovelReaderWeb/docs/HEURISTICS.md, NovelReaderWeb/docs/FEATURES.md",  "reference_project": "C:\\Users\\Pratik\\source\\NovelReaderWeb",  "total_estimated_hours": 18,  "milestones": [    {      "id": "INSIGHTS-M1",      "name": "Emotional Arc Visualization",      "description": "Enhanced chapter-by-chapter emotional arc graph with intensity visualization",      "done": true,      "task_ids": ["INSIGHTS-001"]    },    {      "id": "INSIGHTS-M2",      "name": "Foreshadowing Detection",      "description": "LLM-powered foreshadowing and callback detection across chapters",      "done": true,      "task_ids": ["INSIGHTS-002"]    },    {      "id": "INSIGHTS-M3",      "name": "Extended Analysis Features",      "description": "Sentiment distribution, reading level, and plot outline",      "done": true,      "task_ids": ["INSIGHTS-003", "INSIGHTS-004", "INSIGHTS-005"]    }  ],  "tasks": [    {      "id": "INSIGHTS-001",      "feature": "Enhanced Emotional Arc Visualization",      "description": "Create interactive line graph showing emotional journey across chapters with intensity scores and mood indicators.",      "done": true,      "status": "completed",      "priority": "MEDIUM",      "estimated_hours": 6,      "reference_docs": [        "NovelReaderWeb/docs/HEURISTICS.md - Section 'Emotional Arc Detection'",        "NovelReaderWeb/docs/FEATURES.md - Section 'Emotional Analysis'"      ],      "files_to_modify": [        "app/src/main/java/com/dramebaz/app/ui/insights/InsightsFragment.kt",        "app/src/main/java/com/dramebaz/app/ui/insights/EmotionalArcView.kt (new)",        "app/src/main/res/layout/fragment_insights.xml"      ],      "implementation_notes": "Sample first 1000 chars per chapter for LLM mood extraction. Create line graph with intensity scores (1-10). Color-code by dominant emotion. Add clickable data points to navigate to chapter.",      "work_items": [        "Create EmotionalArcView custom View for line graph",        "Extract emotional_arc data from chapter summaries",        "Plot intensity scores (1-10) on Y-axis, chapters on X-axis",        "Color-code data points by dominant emotion",        "Add smooth bezier curves between points",        "Implement click-to-navigate to specific chapter",        "Add emotion legend with color mapping"      ],      "sub_tasks": [        {"id": "INSIGHTS-001.1", "description": "Create EmotionalArcView.kt custom View", "done": true},        {"id": "INSIGHTS-001.2", "description": "Implement line graph drawing with Canvas", "done": true},        {"id": "INSIGHTS-001.3", "description": "Add emotion color mapping", "done": true},        {"id": "INSIGHTS-001.4", "description": "Add click handling for chapter navigation", "done": true},        {"id": "INSIGHTS-001.5", "description": "Integrate into InsightsFragment", "done": true}      ],      "emotion_colors": {        "joy": "#FFD700",        "sadness": "#4169E1",        "anger": "#FF4500",        "fear": "#800080",        "surprise": "#00CED1",        "neutral": "#808080"      },      "code_pattern": "// From NovelReaderWeb docs/HEURISTICS.md\ndata class EmotionalDataPoint(\n    val chapterIndex: Int,\n    val dominantEmotion: String,\n    val intensity: Float,  // 1.0 to 10.0\n    val secondaryEmotions: List<String>\n)\n\n// Canvas drawing\nfor (i in 0 until dataPoints.size - 1) {\n    val startX = getXForChapter(dataPoints[i].chapterIndex)\n    val startY = getYForIntensity(dataPoints[i].intensity)\n    val endX = getXForChapter(dataPoints[i+1].chapterIndex)\n    val endY = getYForIntensity(dataPoints[i+1].intensity)\n    paint.color = emotionColors[dataPoints[i].dominantEmotion]!!\n    canvas.drawLine(startX, startY, endX, endY, paint)\n}"    },    {      "id": "INSIGHTS-002",      "feature": "Foreshadowing Detection",      "description": "Detect foreshadowing elements and their payoffs/callbacks across chapters using LLM analysis.",      "done": true,      "status": "completed",      "priority": "LOW",      "estimated_hours": 4,      "reference_docs": [        "NovelReaderWeb/docs/HEURISTICS.md - Section 'Foreshadowing Detection'",        "NovelReaderWeb/docs/FEATURES.md - Section 'Literary Analysis'"      ],      "files_to_modify": [        "app/src/main/java/com/dramebaz/app/ai/analysis/ForeshadowingDetector.kt (new)",        "app/src/main/java/com/dramebaz/app/data/models/Foreshadowing.kt (new)",        "app/src/main/java/com/dramebaz/app/ui/insights/ForeshadowingView.kt (new)",        "app/src/main/java/com/dramebaz/app/ui/insights/InsightsFragment.kt"      ],      "implementation_notes": "LLM prompt to identify foreshadowing elements (hints, setups) and their payoffs (resolutions, callbacks). Link elements across chapters. Display as connected timeline in Insights.",      "work_items": [        "Create Foreshadowing data class with setup/payoff structure",        "Create ForeshadowingDetector with LLM prompt",        "Store foreshadowing links in database",        "Create ForeshadowingView timeline visualization",        "Display connected arcs between setup and payoff chapters",        "Add navigation to referenced chapters"      ],      "sub_tasks": [        {"id": "INSIGHTS-002.1", "description": "Create Foreshadowing.kt data model", "done": true},        {"id": "INSIGHTS-002.2", "description": "Create ForeshadowingDetector.kt with LLM prompt", "done": true},        {"id": "INSIGHTS-002.3", "description": "Create ForeshadowingView.kt timeline", "done": true},        {"id": "INSIGHTS-002.4", "description": "Integrate into InsightsFragment", "done": true}      ],      "llm_prompt": "Analyze these chapters for foreshadowing elements:\n\n{chapter_texts}\n\nIdentify:\n1. Setup elements (hints, symbolic objects, ominous statements)\n2. Payoff elements (when the setup pays off or is revealed)\n3. Chapter numbers for both setup and payoff\n\nReturn JSON:\n{\n  \"foreshadowing\": [\n    {\n      \"setup_chapter\": 3,\n      \"setup_text\": \"The old clock stopped at midnight\",\n      \"payoff_chapter\": 12,\n      \"payoff_text\": \"She remembered the clock stopping the night he died\",\n      \"theme\": \"death/time\"\n    }\n  ]\n}",      "code_pattern": "// From NovelReaderWeb docs/HEURISTICS.md\ndata class Foreshadowing(\n    val id: Long,\n    val bookId: Long,\n    val setupChapter: Int,\n    val setupText: String,\n    val payoffChapter: Int,\n    val payoffText: String,\n    val theme: String\n)"    },    {      "id": "INSIGHTS-003",      "feature": "Sentiment Distribution Analysis",      "description": "Analyze overall sentiment distribution (positive/neutral/negative percentages) across the book",      "done": true,      "status": "completed",      "priority": "MEDIUM",      "estimated_hours": 3,      "reference_docs": [        "NovelReaderWeb/src/services/gemini.service.ts - analyzeInsights()"      ],      "files_to_modify": [        "app/src/main/java/com/dramebaz/app/director/LlmDirector.kt",        "app/src/main/java/com/dramebaz/app/ui/insights/InsightsFragment.kt"      ],      "implementation_notes": "Calculate positive/neutral/negative sentiment percentages. Display as pie chart or segmented bar. Show overall tone description.",      "work_items": [        "Add sentiment analysis to LLM prompts",        "Calculate percentages from chapter data",        "Create pie chart or segmented bar visualization",        "Show descriptive tone label (Uplifting, Dark, Balanced, etc.)"      ],      "source_code_reference": "// From NovelReaderWeb gemini.service.ts analyzeInsights()\nsentimentDistribution: {\n  positive: 45,\n  neutral: 30,\n  negative: 25\n}"    },    {      "id": "INSIGHTS-004",      "feature": "Reading Level Analysis",      "description": "Analyze text complexity and suggest grade level or reading difficulty",      "done": true,      "status": "completed",      "priority": "LOW",      "estimated_hours": 2,      "reference_docs": [        "NovelReaderWeb/src/services/gemini.service.ts - analyzeInsights()"      ],      "files_to_modify": [        "app/src/main/java/com/dramebaz/app/director/LlmDirector.kt",        "app/src/main/java/com/dramebaz/app/ui/insights/InsightsFragment.kt"      ],      "implementation_notes": "Use LLM to assess vocabulary complexity, sentence structure, themes. Output grade level (e.g., 'Grade 8', 'Adult', 'Young Adult').",      "work_items": [        "Add reading level analysis to insights LLM prompt",        "Display grade level badge in insights UI",        "Add complexity breakdown (vocabulary, structure, themes)"      ],      "source_code_reference": "// From NovelReaderWeb gemini.service.ts\nreadingLevel: 'Grade 10 / Young Adult'"    },    {      "id": "INSIGHTS-005",      "feature": "Plot Outline Extraction",      "description": "Extract high-level plot points and story structure from the book",      "done": true,      "status": "completed",      "priority": "LOW",      "estimated_hours": 3,      "reference_docs": [        "NovelReaderWeb/src/services/gemini.service.ts - analyzeInsights()"      ],      "files_to_modify": [        "app/src/main/java/com/dramebaz/app/director/LlmDirector.kt",        "app/src/main/java/com/dramebaz/app/data/models/PlotPoint.kt (new)",        "app/src/main/java/com/dramebaz/app/ui/insights/InsightsFragment.kt"      ],      "implementation_notes": "Extract major plot points: Exposition, Rising Action, Climax, Falling Action, Resolution. Link to chapters. Display as story arc timeline.",      "work_items": [        "Create PlotPoint data class",        "Add plot extraction to LLM analysis",        "Display story structure timeline",        "Link plot points to specific chapters"      ],      "source_code_reference": "// From NovelReaderWeb gemini.service.ts\nplotOutline: [\n  { type: 'Exposition', chapter: 1, description: 'Introduction to the protagonist' },\n  { type: 'Inciting Incident', chapter: 3, description: 'Discovery of the mystery' },\n  { type: 'Climax', chapter: 15, description: 'The final confrontation' }\n]"    }  ],  "notes": {    "analysis_timing": "Run foreshadowing detection after all chapters are analyzed",    "performance": "Cache emotional arc data - expensive to recompute",    "llm_usage": "Foreshadowing detection requires multi-chapter context, batch process"  }}