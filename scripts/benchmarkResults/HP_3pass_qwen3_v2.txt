======================================================================
3-PASS WORKFLOW WITH CONTEXT PRESERVATION - BENCHMARK RESULTS
Model: qwen3-1.7b-q4_k_m
PDF: C:\Users\Pratik\Downloads\HP First3Chapters.pdf
Date: 2026-02-01 14:02:46
======================================================================

SUMMARY
----------------------------------------
Model: qwen3-1.7b-q4_k_m
Total Processing Time: 957.0s (16.0 min)
Pages Processed: 5
Total Characters Found: 9
Total Dialogs Extracted: 5
Total Prompt Tokens: 18519
Total Generated Tokens: 783

PASS TIMING BREAKDOWN
----------------------------------------
  pass1          :    107.0s ( 11.2%)
  pass2          :    159.7s ( 16.7%)
  pass3          :    690.2s ( 72.1%)

JSON VALIDITY STATISTICS
----------------------------------------
  pass1          : 2/5 (40% valid)
  pass2          : 1/5 (20% valid)
  pass3          : 5/9 (56% valid)

======================================================================
CHARACTER DETAILS
======================================================================


MR DURSLEY
----------------------------------------
Dialogs: 1
Traits: []
Voice Profile:
  - Pitch: N/A
  - Speed: N/A
  - Energy: N/A
  - Gender: N/A
  - Age: N/A
  - Tone: N/A
  - Speaker ID: N/A

Sample Dialogs:
  [Page 1] (neutral) "I just thought  maybe  it was something to do with you know  her..."

MRS DURSLEY
----------------------------------------
Dialogs: 3
Traits: []
Voice Profile:
  - Pitch: N/A
  - Speed: N/A
  - Energy: N/A
  - Gender: N/A
  - Age: N/A
  - Tone: N/A
  - Speaker ID: N/A

Sample Dialogs:
  [Page 1] (neutral) "The Boy Who Lived..."
  [Page 1] (neutral) "Funny stuff on the news, Mr Dursley mumbled...."
  [Page 1] (angry) "So? snapped Mrs Dursley...."

DUDLEY
----------------------------------------
Dialogs: 0
Traits: []
Voice Profile:
  - Pitch: N/A
  - Speed: N/A
  - Energy: N/A
  - Gender: N/A
  - Age: N/A
  - Tone: N/A
  - Speaker ID: N/A

HARRY POTTER
----------------------------------------
Dialogs: 0
Traits: ['calm', 'intense', 'mysterious']
Voice Profile:
  - Pitch: 1.0
  - Speed: 1.0
  - Energy: 0.7
  - Gender: male
  - Age: young
  - Tone: quiet and brooding, with a hint of intrigue
  - Speaker ID: 55

POTTER
----------------------------------------
Dialogs: 0
Traits: ['calm', 'authoritative', 'mysterious']
Voice Profile:
  - Pitch: 1.0
  - Speed: 1.0
  - Energy: 0.7
  - Gender: male
  - Age: middle-aged
  - Tone: reserved and slightly enigmatic
  - Speaker ID: 65

JIM MCGUFFIN
----------------------------------------
Dialogs: 0
Traits: ['calm', 'authoritative']
Voice Profile:
  - Pitch: 1.0
  - Speed: 1.0
  - Energy: 0.7
  - Gender: male
  - Age: elderly
  - Tone: reserved and focused
  - Speaker ID: 85

PETUNIA
----------------------------------------
Dialogs: 0
Traits: ['calm', 'measured']
Voice Profile:
  - Pitch: 1.0
  - Speed: 1.0
  - Energy: 0.7
  - Gender: female
  - Age: young
  - Tone: composed and slightly weary
  - Speaker ID: 45

ALBUS DUMBLEDORE
----------------------------------------
Dialogs: 0
Traits: []
Voice Profile:
  - Pitch: N/A
  - Speed: N/A
  - Energy: N/A
  - Gender: N/A
  - Age: N/A
  - Tone: N/A
  - Speaker ID: N/A

PROFESSOR MCGONAGALL
----------------------------------------
Dialogs: 0
Traits: ['calm', 'authoritative', 'witty']
Voice Profile:
  - Pitch: 1.0
  - Speed: 1.0
  - Energy: 0.7
  - Gender: female
  - Age: middle-aged
  - Tone: measured and insightful
  - Speaker ID: 65


======================================================================
ALL EXTRACTED DIALOGS
======================================================================

1. [Page 1] Mrs Dursley (neutral, 0.5): "The Boy Who Lived"
2. [Page 1] Narrator (neutral, 0.3): "The Boy Who Lived"
3. [Page 1] Mrs Dursley (neutral, 0.5): "Funny stuff on the news, Mr Dursley mumbled."
4. [Page 1] Mrs Dursley (angry, 0.8): "So? snapped Mrs Dursley."
5. [Page 1] Mr Dursley (neutral, 0.4): "I just thought  maybe  it was something to do with you know  her"


======================================================================
CONTEXT PRESERVATION NOTES
======================================================================

This benchmark differs from the original test_three_pass_workflow.py by:

1. CONTEXT ACCUMULATION: Dialog extraction (Pass-2.5) receives context from
   previously extracted dialogs to help with speaker attribution.

2. FULL PAGE PROCESSING: All pages in the PDF are processed, not just the first page.

3. AGGREGATED CHARACTER CONTEXT: Pass-3 receives aggregated text from ALL
   pages where a character appears for traits and voice profile extraction.

4. CACHE_PROMPT ENABLED: The llama-server API call includes cache_prompt=True
   to enable prompt caching between similar requests.

Note: True conversation history (multi-turn chat) is NOT being used because
the llama-server /completion endpoint is stateless. Each request is independent.
However, we simulate context preservation by including relevant prior results
in subsequent prompts.
